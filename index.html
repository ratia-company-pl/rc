<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4äº‹æ¥­éƒ¨çµ±åˆPLã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆCSVãƒ‡ãƒ¼ã‚¿å¯¾å¿œç‰ˆï¼‰</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 8px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header-section {
            background: rgba(255, 255, 255, 0.98);
            margin-bottom: 0;
        }

        .nav-section {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            padding: 12px 20px;
        }

        .nav-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .btn-nav {
            padding: 8px 14px;
            border: 2px solid rgba(255,255,255,0.25);
            border-radius: 8px;
            background: rgba(255,255,255,0.15);
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            white-space: nowrap;
            cursor: pointer;
        }

        .btn-nav:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-1px);
        }

        .btn-nav.btn-active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-color: #3498db;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }

        .btn-nav.btn-sr { 
            background: linear-gradient(135deg, #f39c12, #e67e22);
            border-color: #f39c12;
        }
        
        .btn-nav.btn-w { 
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-color: #3498db;
        }
        
        .btn-nav.btn-rc { 
            background: linear-gradient(135deg, #27ae60, #229954);
            border-color: #27ae60;
        }
        
        .btn-nav.btn-rcd { 
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            border-color: #9b59b6;
        }

        .workflow-section {
            background: linear-gradient(135deg, #ecf0f1 0%, #d5dbdb 100%);
            padding: 18px 20px;
            border-bottom: 3px solid #667eea;
        }

        .workflow-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
        }

        .workflow-info {
            font-size: 0.9rem;
            color: #34495e;
            text-align: center;
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }

        .workflow-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .chart-section {
            padding: 10px;
            background: white;
            border-top: 1px solid #eee;
        }

        .chart-title {
            font-size: 1.0em;
            font-weight: 700;
            margin-bottom: 12px;
            color: #2c3e50;
            text-align: center;
        }

        .chart-row {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        .chart-graph-cell {
            display: table-cell;
            width: 70%;
            padding-right: 15px;
            vertical-align: middle;
        }

        .chart-kpi-cell {
            display: table-cell;
            width: 30%;
            padding-left: 15px;
            vertical-align: middle;
        }

        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 350px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            border: 2px solid #667eea;
        }

        .chart-kpi-container {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #667eea;
            height: 350px;
        }

        .chart-kpi-title {
            font-size: 0.9em;
            font-weight: 700;
            margin-bottom: 15px;
            color: #667eea;
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .chart-kpi-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            font-size: 0.8em;
        }

        .chart-kpi-item:last-child {
            border-bottom: none;
        }

        .chart-kpi-item-label {
            color: #666;
            font-weight: 600;
        }

        .chart-kpi-item-value {
            font-weight: 700;
            font-size: 1.1em;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 10px;
            background: white;
        }

        .kpi-card {
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .kpi-card.dept { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .kpi-card.common { background: linear-gradient(135deg, #34495e, #2c3e50); color: white; }
        .kpi-card.final-positive { background: linear-gradient(135deg, #27ae60, #229954); color: white; }
        .kpi-card.final-negative { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        .kpi-card.target { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; }

        .kpi-label {
            font-size: 0.65em;
            margin-bottom: 2px;
            opacity: 0.9;
        }

        .kpi-value {
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 1px;
        }

        .kpi-detail {
            font-size: 0.55em;
            opacity: 0.8;
        }

        .dept-comparison-section {
            padding: 10px;
            background: white;
            border-top: 1px solid #eee;
        }

        .section-title {
            font-size: 0.85em;
            font-weight: 700;
            margin-bottom: 8px;
            color: #2c3e50;
            border-left: 3px solid #667eea;
            padding-left: 6px;
        }

        .dept-comparison-row {
            display: table;
            width: 100%;
            table-layout: fixed;
            margin-bottom: 12px;
        }

        .dept-graph-cell {
            display: table-cell;
            width: 70%;
            padding-right: 10px;
            vertical-align: middle;
        }

        .dept-kpi-cell {
            display: table-cell;
            width: 30%;
            padding-left: 10px;
            vertical-align: middle;
        }

        .dept-graph-container {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 6px;
            border: 2px solid #dee2e6;
            height: 180px;
        }

        .dept-graph-header {
            font-size: 0.75em;
            font-weight: bold;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dept-kpi-container {
            background: white;
            padding: 8px;
            border-radius: 6px;
            border: 2px solid;
            height: 100%;
        }

        .kpi-item {
            display: flex;
            justify-content: space-between;
            padding: 2px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            font-size: 0.65em;
        }

        .kpi-item:last-child {
            border-bottom: none;
        }

        .kpi-item-label {
            color: #666;
            font-weight: 500;
        }

        .kpi-item-value {
            font-weight: bold;
        }

        /* äº‹æ¥­éƒ¨ã‚«ãƒ©ãƒ¼å®šç¾© */
        .dept-sr { color: #f39c12; border-color: #f39c12 !important; }
        .dept-sr .dept-graph-header { color: #f39c12; }
        .dept-sr .kpi-item-value { color: #f39c12; }

        .dept-w { color: #3498db; border-color: #3498db !important; }
        .dept-w .dept-graph-header { color: #3498db; }
        .dept-w .kpi-item-value { color: #3498db; }

        .dept-rc { color: #27ae60; border-color: #27ae60 !important; }
        .dept-rc .dept-graph-header { color: #27ae60; }
        .dept-rc .kpi-item-value { color: #27ae60; }

        .dept-rcd { color: #9b59b6; border-color: #9b59b6 !important; }
        .dept-rcd .dept-graph-header { color: #9b59b6; }
        .dept-rcd .kpi-item-value { color: #9b59b6; }

        .target-section {
            padding: 10px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
        }

        .target-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .target-toggle {
            padding: 4px 12px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.7em;
            transition: all 0.3s ease;
        }

        .toggle-active {
            background: #27ae60;
            color: white;
        }

        .toggle-inactive {
            background: #bdc3c7;
            color: #7f8c8d;
        }

        .target-input input {
            padding: 3px 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 80px;
            font-size: 0.75em;
        }

        .micro-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.65em;
            margin-bottom: 8px;
        }

        .micro-table th,
        .micro-table td {
            padding: 2px 4px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .micro-table th {
            background: #34495e;
            color: white;
            font-weight: 600;
            font-size: 0.6em;
        }

        .micro-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        /* å½¹å“¡å ±é…¬ã‚»ã‚¯ã‚·ãƒ§ãƒ³å¼·èª¿ */
        .executive-section {
            background: #e8f5e8;
            border: 2px solid #27ae60;
            border-radius: 8px;
            margin: 10px;
            padding: 15px;
        }

        .executive-title {
            color: #2c3e50;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 2px solid #27ae60;
            padding-bottom: 5px;
        }

        .csv-data-highlight {
            background: #fff3cd;
            border: 1px solid #f39c12;
            border-radius: 4px;
            padding: 8px;
            margin: 8px 0;
            font-size: 0.75em;
        }

        .debug-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin: 10px;
            padding: 8px;
        }

        .debug-title {
            font-size: 0.75em;
            font-weight: bold;
            margin-bottom: 6px;
            color: #495057;
        }

        .debug-content {
            font-family: 'Courier New', monospace;
            font-size: 0.65em;
            background: white;
            border: 1px solid #ced4da;
            border-radius: 3px;
            padding: 6px;
            max-height: 150px;
            overflow-y: auto;
        }

        .action-buttons {
            padding: 10px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .status-indicator {
            font-size: 0.7em;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .status-complete { background: #d4edda; color: #155724; }
        .status-partial { background: #fff3cd; color: #856404; }
        .status-error { background: #f8d7da; color: #721c24; }

        .positive { color: #27ae60; }
        .negative { color: #e74c3c; }
        .neutral { color: #6c757d; }

        @media (max-width: 768px) {
            .kpi-grid { grid-template-columns: 1fr; }
            
            .dept-comparison-row {
                display: block;
            }
            
            .dept-graph-cell, .dept-kpi-cell {
                display: block;
                width: 100%;
                padding: 0;
                margin-bottom: 10px;
            }

            .nav-buttons { gap: 6px; }
            .btn-nav { padding: 6px 10px; font-size: 0.7rem; }
            .workflow-actions { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <div class="nav-section">
                <div class="nav-buttons">
                    <button class="btn-nav btn-active">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</button>
                    <button class="btn-nav btn-sr" onclick="location.href='department-pl/sr-pl.html'">SRäº‹æ¥­éƒ¨PL</button>
                    <button class="btn-nav btn-w" onclick="location.href='department-pl/w-pl.html'">Wäº‹æ¥­éƒ¨PL</button>
                    <button class="btn-nav btn-rc" onclick="location.href='department-pl/rc-pl.html'">RCäº‹æ¥­éƒ¨PL</button>
                    <button class="btn-nav btn-rcd" onclick="location.href='department-pl/rcd-pl.html'">RCDäº‹æ¥­éƒ¨PL</button>
                    <button class="btn-nav" onclick="location.href='combined-dashboard/index.html'">å…¨ä½“PLåˆ†æ</button>
                </div>
            </div>

            <div class="workflow-section">
                <div class="workflow-title">çµ±åˆPLã‚·ã‚¹ãƒ†ãƒ  ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ - å…¨äº‹æ¥­éƒ¨ãƒ‡ãƒ¼ã‚¿çµ±åˆä¸­</div>
                <div class="workflow-info">
                    <span style="color: #27ae60; font-weight: 600;">âœ“ SRäº‹æ¥­éƒ¨å®Œäº†</span>
                    <span style="margin: 0 10px; color: #bdc3c7;">|</span>
                    <span style="color: #27ae60; font-weight: 600;">âœ“ Wäº‹æ¥­éƒ¨å®Œäº†</span>
                    <span style="margin: 0 10px; color: #bdc3c7;">|</span>
                    <span style="color: #27ae60; font-weight: 600;">âœ“ RCäº‹æ¥­éƒ¨å®Œäº†</span>
                    <span style="margin: 0 10px; color: #bdc3c7;">|</span>
                    <span style="color: #27ae60; font-weight: 600;">âœ“ RCDäº‹æ¥­éƒ¨å®Œäº†</span>
                    <span style="margin: 0 10px; color: #bdc3c7;">â†’</span>
                    <span style="color: #667eea; font-weight: 700;">â— çµ±åˆPLåˆ†æä¸­</span>
                </div>
                <div class="workflow-actions">
                    <button class="action-btn btn-primary" onclick="location.href='combined-dashboard/index.html'">
                        å…¨ä½“PLçµ±åˆåˆ†æã‚’é–‹å§‹
                    </button>
                    <button class="action-btn btn-secondary" onclick="refreshDashboardData()">
                        ãƒ‡ãƒ¼ã‚¿åŒæœŸãƒ»æ›´æ–°
                    </button>
                </div>
            </div>
        </div>

        <div class="chart-section">
            <div class="chart-title">æœˆæ¬¡åˆ©ç›Šæ¨ç§»ï¼ˆçµ±åˆPLãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€£å‹•å¯¾å¿œï¼‰</div>
            
            <div class="chart-row">
                <div class="chart-graph-cell">
                    <div class="chart-wrapper">
                        <canvas id="monthly-profit-chart"></canvas>
                    </div>
                </div>
                <div class="chart-kpi-cell">
                    <div class="chart-kpi-container">
                        <div class="chart-kpi-title">çµ±åˆå®Ÿç¸¾ã‚µãƒãƒªãƒ¼</div>
                        <div class="chart-kpi-item">
                            <span class="chart-kpi-item-label">å¹´é–“å£²ä¸Šåˆè¨ˆ</span>
                            <span class="chart-kpi-item-value" id="total-annual-sales">238,641ä¸‡å††</span>
                        </div>
                        <div class="chart-kpi-item">
                            <span class="chart-kpi-item-label">å¹³å‡æœˆæ¬¡å£²ä¸Š</span>
                            <span class="chart-kpi-item-value" id="avg-monthly-sales">19,887ä¸‡å††</span>
                        </div>
                        <div class="chart-kpi-item">
                            <span class="chart-kpi-item-label">å¹´é–“åˆ©ç›Šåˆè¨ˆ</span>
                            <span class="chart-kpi-item-value positive" id="total-annual-profit">+3,250ä¸‡å††</span>
                        </div>
                        <div class="chart-kpi-item">
                            <span class="chart-kpi-item-label">å¹³å‡æœˆæ¬¡åˆ©ç›Š</span>
                            <span class="chart-kpi-item-value positive" id="avg-monthly-profit">+271ä¸‡å††</span>
                        </div>
                        <div class="chart-kpi-item">
                            <span class="chart-kpi-item-label">åˆ©ç›Šç‡</span>
                            <span class="chart-kpi-item-value" id="profit-margin">1.36%</span>
                        </div>
                        <div class="chart-kpi-item">
                            <span class="chart-kpi-item-label">ç´¯è¨ˆé€²æ—</span>
                            <span class="chart-kpi-item-value positive" id="cumulative-progress">+3,250ä¸‡å††</span>
                        </div>
                        <div class="chart-kpi-item">
                            <span class="chart-kpi-item-label">æœ€é«˜æœˆé–“åˆ©ç›Š</span>
                            <span class="chart-kpi-item-value positive" id="max-monthly-profit">+500ä¸‡å††</span>
                        </div>
                        <div class="chart-kpi-item">
                            <span class="chart-kpi-item-label">æœ€ä½æœˆé–“åˆ©ç›Š</span>
                            <span class="chart-kpi-item-value negative" id="min-monthly-profit">-200ä¸‡å††</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="dept-comparison-section">
            <div class="section-title">Step2-3: å„äº‹æ¥­éƒ¨å€‹åˆ¥ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºãƒ»åˆ†æï¼ˆå‰å¹´åŒæœˆå®Ÿç¸¾æ¯”è¼ƒï¼‰</div>
            
            <!-- SRäº‹æ¥­éƒ¨ -->
            <div class="dept-comparison-row">
                <div class="dept-graph-cell">
                    <div class="dept-graph-container">
                        <div class="dept-graph-header dept-sr">
                            <span>SRäº‹æ¥­éƒ¨</span>
                            <span id="sr-yoy-summary" style="font-size: 0.9em;">å‰å¹´æ¯”: +4.2%</span>
                        </div>
                        <div style="position: relative; height: 150px; background: white; border-radius: 4px;">
                            <canvas id="sr-monthly-chart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="dept-kpi-cell">
                    <div class="dept-kpi-container dept-sr">
                        <div class="kpi-item">
                            <span class="kpi-item-label">å‰å¹´å£²ä¸Š</span>
                            <span class="kpi-item-value">31,382ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">ä»ŠæœŸå£²ä¸Š</span>
                            <span class="kpi-item-value" id="sr-sim-sales">32,700ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">å¢—é¡</span>
                            <span class="kpi-item-value positive" id="sr-increase">+1,318ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">ä¼¸ã³ç‡</span>
                            <span class="kpi-item-value positive" id="sr-growth">+4%</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">æœˆæ¬¡åˆ©ç›Š</span>
                            <span class="kpi-item-value negative" id="sr-profit">-233ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">ç´¯è¨ˆåˆ©ç›Š</span>
                            <span class="kpi-item-value negative" id="sr-cumulative">-2,800ä¸‡å††</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Wäº‹æ¥­éƒ¨ -->
            <div class="dept-comparison-row">
                <div class="dept-graph-cell">
                    <div class="dept-graph-container">
                        <div class="dept-graph-header dept-w">
                            <span>Wäº‹æ¥­éƒ¨</span>
                            <span id="w-yoy-summary" style="font-size: 0.9em;">å‰å¹´æ¯”: -2.1%</span>
                        </div>
                        <div style="position: relative; height: 150px; background: white; border-radius: 4px;">
                            <canvas id="w-monthly-chart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="dept-kpi-cell">
                    <div class="dept-kpi-container dept-w">
                        <div class="kpi-item">
                            <span class="kpi-item-label">å‰å¹´å£²ä¸Š</span>
                            <span class="kpi-item-value">11,521ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">ä»ŠæœŸå£²ä¸Š</span>
                            <span class="kpi-item-value" id="w-sim-sales">11,285ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">å¢—é¡</span>
                            <span class="kpi-item-value negative" id="w-increase">-236ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">ä¼¸ã³ç‡</span>
                            <span class="kpi-item-value negative" id="w-growth">-2%</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">æœˆæ¬¡åˆ©ç›Š</span>
                            <span class="kpi-item-value positive" id="w-profit">+175ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">ç´¯è¨ˆåˆ©ç›Š</span>
                            <span class="kpi-item-value positive" id="w-cumulative">+2,100ä¸‡å††</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RCäº‹æ¥­éƒ¨ -->
            <div class="dept-comparison-row">
                <div class="dept-graph-cell">
                    <div class="dept-graph-container">
                        <div class="dept-graph-header dept-rc">
                            <span>RCäº‹æ¥­éƒ¨</span>
                            <span id="rc-yoy-summary" style="font-size: 0.9em;">å‰å¹´æ¯”: +7.6%</span>
                        </div>
                        <div style="position: relative; height: 150px; background: white; border-radius: 4px;">
                            <canvas id="rc-monthly-chart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="dept-kpi-cell">
                    <div class="dept-kpi-container dept-rc">
                        <div class="kpi-item">
                            <span class="kpi-item-label">å‰å¹´å£²ä¸Š</span>
                            <span class="kpi-item-value">18,359ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">ä»ŠæœŸå£²ä¸Š</span>
                            <span class="kpi-item-value" id="rc-sim-sales">19,755ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">å¢—é¡</span>
                            <span class="kpi-item-value positive" id="rc-increase">+1,396ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">ä¼¸ã³ç‡</span>
                            <span class="kpi-item-value positive" id="rc-growth">+8%</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">æœˆæ¬¡åˆ©ç›Š</span>
                            <span class="kpi-item-value positive" id="rc-profit">+117ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">ç´¯è¨ˆåˆ©ç›Š</span>
                            <span class="kpi-item-value positive" id="rc-cumulative">+1,400ä¸‡å††</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RCDäº‹æ¥­éƒ¨ -->
            <div class="dept-comparison-row">
                <div class="dept-graph-cell">
                    <div class="dept-graph-container">
                        <div class="dept-graph-header dept-rcd">
                            <span>RCDäº‹æ¥­éƒ¨ï¼ˆè¨ˆç”»å—æ³¨ï¼‰</span>
                            <span id="rcd-yoy-summary" style="font-size: 0.9em;">å‰å¹´æ¯”: +2.8%</span>
                        </div>
                        <div style="position: relative; height: 150px; background: white; border-radius: 4px;">
                            <canvas id="rcd-monthly-chart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="dept-kpi-cell">
                    <div class="dept-kpi-container dept-rcd">
                        <div class="kpi-item">
                            <span class="kpi-item-label">å‰å¹´å£²ä¸Š</span>
                            <span class="kpi-item-value">170,179ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">ä»ŠæœŸå£²ä¸Š</span>
                            <span class="kpi-item-value" id="rcd-sim-sales">174,901ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">å¢—é¡</span>
                            <span class="kpi-item-value positive" id="rcd-increase">+4,722ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">ä¼¸ã³ç‡</span>
                            <span class="kpi-item-value positive" id="rcd-growth">+3%</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">æœˆæ¬¡åˆ©ç›Š</span>
                            <span class="kpi-item-value positive" id="rcd-profit">+83ä¸‡å††</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-item-label">ç´¯è¨ˆåˆ©ç›Š</span>
                            <span class="kpi-item-value positive" id="rcd-cumulative">+1,000ä¸‡å††</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="target-section">
            <div class="section-title">ç›®æ¨™é…åˆ†æ©Ÿèƒ½ï¼ˆæå¤±åœ§ç¸®ãƒ­ã‚¸ãƒƒã‚¯ï¼‰</div>
            
            <div class="target-controls">
                <button id="allocation-toggle-btn" class="target-toggle toggle-inactive">
                    ç›®æ¨™é…åˆ†OFF
                </button>
                <div class="target-input">
                    <label style="font-size: 0.7em;">å¹´é–“ç›®æ¨™:</label>
                    <input type="number" id="total-target" value="6000" step="100">
                    <span style="font-size: 0.7em;">ä¸‡å††</span>
                </div>
                <button class="action-btn btn-secondary" style="font-size: 0.7em; padding: 6px 12px;" onclick="testTargetFunction()">
                    å‹•ä½œãƒ†ã‚¹ãƒˆ
                </button>
            </div>

            <div id="allocation-results" style="display: none;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div>
                        <table class="micro-table">
                            <thead>
                                <tr>
                                    <th>äº‹æ¥­éƒ¨</th>
                                    <th>æˆ¦ç•¥</th>
                                    <th>ç¾åœ¨åˆ©ç›Š</th>
                                    <th>ç›®æ¨™åˆ©ç›Š</th>
                                    <th>æ”¹å–„é¡</th>
                                    <th>å£²ä¸Šå¢—ç‡</th>
                                    <th>ç¾å®Ÿæ€§</th>
                                </tr>
                            </thead>
                            <tbody id="allocation-table">
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="background: white; padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                        <div style="font-size: 0.7em; font-weight: 600; margin-bottom: 8px; text-align: center; color: #2c3e50;">åˆ©ç›Šæ¯”è¼ƒãƒãƒ£ãƒ¼ãƒˆ</div>
                        <div style="position: relative; height: 200px;">
                            <canvas id="profit-comparison-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="background: #fff3cd; padding: 6px; border-radius: 4px; font-size: 0.65em; margin-top: 6px;">
                    <strong>é…åˆ†ãƒ­ã‚¸ãƒƒã‚¯:</strong>
                    èµ¤å­—äº‹æ¥­éƒ¨ï¼ˆSRï¼‰:æœˆ+100ä¸‡å›ºå®š | é»’å­—äº‹æ¥­éƒ¨ï¼ˆWãƒ»RCï¼‰:åŠ¹ç‡é…åˆ† | RCDï¼šè¨ˆç”»å—æ³¨ã«ã‚ˆã‚Šé™¤å¤– | åˆ¶ç´„:å£²ä¸Šå¢—20%ä¸Šé™
                </div>
            </div>
        </div>

        <!-- CSVãƒ‡ãƒ¼ã‚¿å¯¾å¿œå½¹å“¡å ±é…¬ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="executive-section">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                <div class="executive-title" style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;">å½¹å“¡å ±é…¬è¨­å®š</div>
                <div class="csv-data-highlight" style="margin: 0; flex-grow: 1;">
                    <strong>ğŸ“Š CSVãƒ‡ãƒ¼ã‚¿åæ˜ æ¸ˆã¿:</strong> å½¹å“¡å ±é…¬ã¯å®Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆ7-9æœˆ:826ä¸‡å††ã€10-6æœˆ:676ä¸‡å††ã€å¹´é–“è¨ˆ8,556ä¸‡å††ï¼‰ã«åŸºã¥ã„ã¦è‡ªå‹•è¨ˆç®—ã•ã‚Œã¦ã„ã¾ã™ã€‚
                </div>
            </div>
            
            <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #27ae60;">
                <!-- 1è¡Œç›®ï¼šæœˆé¡è¨­å®š -->
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 8px;">
                    <div style="font-size: 0.8em; font-weight: bold; color: #2c3e50; min-width: 80px;">æœˆé¡è¨­å®š</div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-size: 0.7em; color: #666;">7-9æœˆåŸºæº–:</label>
                        <input type="number" id="base-salary-high" value="826" step="10" readonly style="width: 60px; padding: 2px; border: 1px solid #ddd; border-radius: 3px; font-size: 0.7em; background: #f8f9fa;">
                        <span style="font-size: 0.65em;">ä¸‡å††</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-size: 0.7em; color: #666;">10-6æœˆåŸºæº–:</label>
                        <input type="number" id="base-salary-low" value="676" step="10" readonly style="width: 60px; padding: 2px; border: 1px solid #ddd; border-radius: 3px; font-size: 0.7em; background: #f8f9fa;">
                        <span style="font-size: 0.65em;">ä¸‡å††</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-size: 0.7em; color: #666;">èª¿æ•´é¡:</label>
                        <input type="number" id="adjustment-amount" value="0" step="50" style="width: 60px; padding: 2px; border: 1px solid #ddd; border-radius: 3px; font-size: 0.7em;">
                        <span style="font-size: 0.65em;">ä¸‡å††</span>
                    </div>
                    <!-- é©ç”¨ãƒœã‚¿ãƒ³ã‚’å³å´ã«é…ç½® -->
                    <div style="margin-left: auto;">
                        <button class="action-btn" style="background: #27ae60; font-size: 0.7em; padding: 6px 16px;" onclick="applyExecutiveAdjustment()">
                            è¨­å®šã‚’é©ç”¨
                        </button>
                    </div>
                </div>
                
                <!-- 2è¡Œç›®ï¼šå½¹å“¡å ±é…¬ -->
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 8px;">
                    <div style="font-size: 0.8em; font-weight: bold; color: #2c3e50; min-width: 80px;">å½¹å“¡å ±é…¬</div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-size: 0.7em; color: #666;">6æœˆå½¹å“¡è³ä¸:</label>
                        <input type="number" id="bonus-june" value="0" step="50" style="width: 60px; padding: 2px; border: 1px solid #ddd; border-radius: 3px; font-size: 0.7em;">
                        <span style="font-size: 0.65em;">ä¸‡å††</span>
                    </div>
                    <div style="font-size: 0.9em; font-weight: bold; color: #00bcd4;">
                        6æœˆã®æœˆé¡è²»ã«åŠ ç®—
                    </div>
                </div>
                
                <!-- æœˆåˆ¥è¡¨ç¤ºãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆç°¡ç•¥åŒ–ç‰ˆï¼‰ -->
                <div style="margin-top: 15px; overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.65em;">
                        <thead>
                            <tr style="background: #27ae60; color: white;">
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd;">é …ç›®</th>
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd;">7æœˆ</th>
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd;">8æœˆ</th>
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd;">9æœˆ</th>
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd;">10æœˆ</th>
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd;">11æœˆ</th>
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd;">12æœˆ</th>
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd;">1æœˆ</th>
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd;">2æœˆ</th>
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd;">3æœˆ</th>
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd;">4æœˆ</th>
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd;">5æœˆ</th>
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd;">6æœˆ</th>
                                <th style="padding: 4px; text-align: center; border: 1px solid #ddd; font-weight: bold;">å¹´è¨ˆ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #e8f5e8;">
                                <td style="padding: 4px; border: 1px solid #ddd; font-weight: bold;">å½¹å“¡å ±é…¬</td>
                                <td id="exec-m0" style="padding: 4px; text-align: right; border: 1px solid #ddd;">826</td>
                                <td id="exec-m1" style="padding: 4px; text-align: right; border: 1px solid #ddd;">826</td>
                                <td id="exec-m2" style="padding: 4px; text-align: right; border: 1px solid #ddd;">826</td>
                                <td id="exec-m3" style="padding: 4px; text-align: right; border: 1px solid #ddd;">676</td>
                                <td id="exec-m4" style="padding: 4px; text-align: right; border: 1px solid #ddd;">676</td>
                                <td id="exec-m5" style="padding: 4px; text-align: right; border: 1px solid #ddd;">676</td>
                                <td id="exec-m6" style="padding: 4px; text-align: right; border: 1px solid #ddd;">676</td>
                                <td id="exec-m7" style="padding: 4px; text-align: right; border: 1px solid #ddd;">676</td>
                                <td id="exec-m8" style="padding: 4px; text-align: right; border: 1px solid #ddd;">676</td>
                                <td id="exec-m9" style="padding: 4px; text-align: right; border: 1px solid #ddd;">676</td>
                                <td id="exec-m10" style="padding: 4px; text-align: right; border: 1px solid #ddd;">676</td>
                                <td id="exec-m11" style="padding: 4px; text-align: right; border: 1px solid #ddd; font-weight: bold; background: #e1f5fe; color: #00bcd4;">676</td>
                                <td id="exec-total" style="padding: 4px; text-align: right; border: 1px solid #ddd; font-weight: bold;">8,556</td>
                            </tr>
                            <tr style="background: #fff;">
                                <td style="padding: 4px; border: 1px solid #ddd; font-weight: bold;">æ³•å®šç¦åˆ©è²»</td>
                                <td id="welfare-m0" style="padding: 4px; text-align: right; border: 1px solid #ddd;">107</td>
                                <td id="welfare-m1" style="padding: 4px; text-align: right; border: 1px solid #ddd;">107</td>
                                <td id="welfare-m2" style="padding: 4px; text-align: right; border: 1px solid #ddd;">107</td>
                                <td id="welfare-m3" style="padding: 4px; text-align: right; border: 1px solid #ddd;">88</td>
                                <td id="welfare-m4" style="padding: 4px; text-align: right; border: 1px solid #ddd;">88</td>
                                <td id="welfare-m5" style="padding: 4px; text-align: right; border: 1px solid #ddd;">88</td>
                                <td id="welfare-m6" style="padding: 4px; text-align: right; border: 1px solid #ddd;">88</td>
                                <td id="welfare-m7" style="padding: 4px; text-align: right; border: 1px solid #ddd;">88</td>
                                <td id="welfare-m8" style="padding: 4px; text-align: right; border: 1px solid #ddd;">88</td>
                                <td id="welfare-m9" style="padding: 4px; text-align: right; border: 1px solid #ddd;">88</td>
                                <td id="welfare-m10" style="padding: 4px; text-align: right; border: 1px solid #ddd;">88</td>
                                <td id="welfare-m11" style="padding: 4px; text-align: right; border: 1px solid #ddd;">88</td>
                                <td id="welfare-total" style="padding: 4px; text-align: right; border: 1px solid #ddd; font-weight: bold;">1,115</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="debug-section">
            <div class="debug-title">CSVãƒ‡ãƒ¼ã‚¿å¯¾å¿œç‰ˆãƒ‡ãƒãƒƒã‚°: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸçŠ¶æ³</div>
            <div class="debug-content" id="debug-output">
                CSVãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...
            </div>
        </div>

        <div class="action-buttons">
            <button class="action-btn" style="background: #3498db; color: white;" onclick="refreshDashboardData()">å…¨ãƒ‡ãƒ¼ã‚¿æ›´æ–°</button>
            <div class="status-indicator status-complete">
                <span>ğŸ“Š</span>
                <span id="data-sync-status-text">ãƒ‡ãƒ¼ã‚¿å–å¾—: 4/4éƒ¨é–€</span>
            </div>
            <div class="status-indicator status-complete">
                <span>ğŸ”—</span>
                <span id="integration-status-text">çµ±åˆPLé€£æº: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</span>
            </div>
            <button class="action-btn" style="background: #27ae60; color: white;" onclick="exportDebugData()">ãƒ‡ãƒãƒƒã‚°æƒ…å ±å‡ºåŠ›</button>
            <button class="action-btn" style="background: #9b59b6; color: white;" onclick="toggleDebugMode()">ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºåˆ‡æ›¿</button>
            <button class="action-btn" style="background: #1abc9c; color: white;" onclick="loadIntegrationData()">çµ±åˆPLé€£æºç¢ºèª</button>
            <button class="action-btn" style="background: #e67e22; color: white;" onclick="enableAutoSync()">è‡ªå‹•åŒæœŸé–‹å§‹</button>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°å®šç¾©
        let targetAllocationEnabled = false;
        let monthlyProfitChart = null;
        let departmentCharts = {};
        let profitComparisonChart = null;

        // å‰å¹´å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿å®šç¾©
        const PREVIOUS_YEAR_DATA = {
            sr: {
                name: 'SRäº‹æ¥­éƒ¨',
                monthly: [2236, 2916, 2927, 2810, 2544, 2663, 3008, 2324, 2403, 2602, 2228, 2721],
                annual: 31382
            },
            w: {
                name: 'Wäº‹æ¥­éƒ¨',
                monthly: [886, 500, 669, 1174, 1257, 2331, 712, 772, 865, 824, 608, 923],
                annual: 11521
            },
            rc: {
                name: 'RCäº‹æ¥­éƒ¨',
                monthly: [1947, 1645, 1530, 1730, 1165, 1846, 1475, 1585, 1241, 1173, 1602, 1420],
                annual: 18359
            },
            rcd: {
                name: 'RCDäº‹æ¥­éƒ¨',
                monthly: [11037, 14297, 11504, 14664, 12507, 14920, 13661, 15455, 14439, 15857, 15478, 16360],
                annual: 170179
            }
        };

        // äº‹æ¥­éƒ¨ã‚«ãƒ©ãƒ¼å®šç¾©
        const DEPT_COLORS = {
            sr: '#f39c12',
            w: '#3498db',
            rc: '#27ae60',
            rcd: '#9b59b6'
        };

        // éƒ¨é–€ãƒ‡ãƒ¼ã‚¿ï¼ˆä»®ãƒ‡ãƒ¼ã‚¿ï¼‰
        const departmentCurrentData = {
            sr: { sales: 32700, profit: -2800 },
            w: { sales: 11285, profit: 2100 },
            rc: { sales: 19755, profit: 1400 },
            rcd: { sales: 174901, profit: 1000 }
        };

        // ç›®æ¨™é…åˆ†æ©Ÿèƒ½
        function toggleTargetAllocation() {
            console.log('toggleTargetAllocation called');
            
            targetAllocationEnabled = !targetAllocationEnabled;
            const btn = document.getElementById('allocation-toggle-btn');
            const results = document.getElementById('allocation-results');
            const statusEl = document.getElementById('target-status');
            
            if (targetAllocationEnabled) {
                btn.textContent = 'ç›®æ¨™é…åˆ†ON';
                btn.className = 'target-toggle toggle-active';
                results.style.display = 'block';
                updateTargetAllocation();
            } else {
                btn.textContent = 'ç›®æ¨™é…åˆ†OFF';
                btn.className = 'target-toggle toggle-inactive';
                results.style.display = 'none';
            }
            
            if (statusEl) {
                statusEl.textContent = targetAllocationEnabled ? 'ç›®æ¨™é…åˆ†ON' : 'ç›®æ¨™é…åˆ†OFF';
            }
        }

        function updateTargetAllocation() {
            if (!targetAllocationEnabled) return;
            
            const totalTarget = parseInt(document.getElementById('total-target').value) || 6000;
            
            const currentProfits = {
                sr: departmentCurrentData.sr.profit,
                w: departmentCurrentData.w.profit,
                rc: departmentCurrentData.rc.profit,
                rcd: departmentCurrentData.rcd.profit
            };
            
            const allocation = calculateTargetAllocation(currentProfits, totalTarget);
            displayAllocationResults(allocation);
        }

        function calculateTargetAllocation(currentProfits, totalTarget) {
            const currentTotal = Object.values(currentProfits).reduce((sum, val) => sum + val, 0);
            const improvementNeeded = totalTarget - currentTotal;
            
            return {
                sr: { current: currentProfits.sr, target: currentProfits.sr + 1200, strategy: 'æœˆ+100ä¸‡å›ºå®š' },
                w: { current: currentProfits.w, target: currentProfits.w + (improvementNeeded * 0.4), strategy: 'åŠ¹ç‡æ”¹å–„' },
                rc: { current: currentProfits.rc, target: currentProfits.rc + (improvementNeeded * 0.3), strategy: 'åŠ¹ç‡æ”¹å–„' },
                rcd: { current: currentProfits.rcd, target: currentProfits.rcd, strategy: 'è¨ˆç”»å—æ³¨ç¶­æŒ' }
            };
        }

        function displayAllocationResults(allocation) {
            const tableBody = document.getElementById('allocation-table');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            Object.entries(allocation).forEach(([dept, data]) => {
                const improvement = data.target - data.current;
                const salesIncrease = data.current > 0 ? (improvement / data.current * 100) : 0;
                const feasibility = salesIncrease <= 20 ? 'ç¾å®Ÿçš„' : 'å›°é›£';
                
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${dept.toUpperCase()}</td>
                    <td>${data.strategy}</td>
                    <td>${Math.round(data.current).toLocaleString()}</td>
                    <td>${Math.round(data.target).toLocaleString()}</td>
                    <td class="${improvement >= 0 ? 'positive' : 'negative'}">${Math.round(improvement).toLocaleString()}</td>
                    <td>${salesIncrease.toFixed(1)}%</td>
                    <td class="${feasibility === 'ç¾å®Ÿçš„' ? 'positive' : 'negative'}">${feasibility}</td>
                `;
            });
            
            createProfitComparisonChart(allocation);
        }

        function createProfitComparisonChart(allocation) {
            const ctx = document.getElementById('profit-comparison-chart');
            if (!ctx) return;

            if (profitComparisonChart) {
                profitComparisonChart.destroy();
            }

            const departments = Object.keys(allocation);
            const currentData = departments.map(dept => allocation[dept].current);
            const targetData = departments.map(dept => allocation[dept].target);

            profitComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: departments.map(d => d.toUpperCase()),
                    datasets: [
                        {
                            label: 'ç¾åœ¨åˆ©ç›Š',
                            data: currentData,
                            backgroundColor: 'rgba(231, 76, 60, 0.7)',
                            borderColor: 'rgba(231, 76, 60, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'ç›®æ¨™åˆ©ç›Š',
                            data: targetData,
                            backgroundColor: 'rgba(46, 204, 113, 0.7)',
                            borderColor: 'rgba(46, 204, 113, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: { font: { size: 10 } }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                font: { size: 9 },
                                callback: function(value) {
                                    return value.toLocaleString() + 'ä¸‡å††';
                                }
                            }
                        },
                        x: {
                            ticks: { font: { size: 9 } }
                        }
                    }
                }
            });
        }

        // æœˆæ¬¡åˆ©ç›Šæ¨ç§»ãƒãƒ£ãƒ¼ãƒˆä½œæˆï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿å¯¾å¿œç‰ˆï¼‰
        function createMonthlyProfitChart() {
            const ctx = document.getElementById('monthly-profit-chart');
            if (!ctx) return;

            const months = ['7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ', '1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'];
            
            // ä»ŠæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
            const monthlySales = [18500, 19200, 20100, 18800, 19600, 21200, 19800, 20500, 21000, 19300, 20800, 22000];
            const monthlyProfit = [150, -200, 300, 450, 200, -100, 500, 350, 400, 250, 300, 450];
            
            // å‰å¹´åŒæœˆãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ï¼‰- 4äº‹æ¥­éƒ¨ã®æœˆæ¬¡åˆè¨ˆ
            const prevYearSales = [];
            const prevYearProfit = [];
            
            for (let i = 0; i < 12; i++) {
                // å‰å¹´å£²ä¸Šåˆè¨ˆ
                const salesTotal = PREVIOUS_YEAR_DATA.sr.monthly[i] + 
                                 PREVIOUS_YEAR_DATA.w.monthly[i] + 
                                 PREVIOUS_YEAR_DATA.rc.monthly[i] + 
                                 PREVIOUS_YEAR_DATA.rcd.monthly[i];
                prevYearSales.push(salesTotal);
                
                // å‰å¹´åˆ©ç›Šåˆè¨ˆ
                const profitTotal = PREVIOUS_YEAR_DATA.sr.profit[i] + 
                                  PREVIOUS_YEAR_DATA.w.profit[i] + 
                                  PREVIOUS_YEAR_DATA.rc.profit[i] + 
                                  PREVIOUS_YEAR_DATA.rcd.profit[i];
                prevYearProfit.push(profitTotal);
            }
            
            // ç´¯è¨ˆå–¶æ¥­åˆ©ç›Šã®è¨ˆç®—
            const cumulativeProfit = [];
            const prevCumulativeProfit = [];
            let cumulative = 0;
            let prevCumulative = 0;
            
            for (let i = 0; i < monthlyProfit.length; i++) {
                cumulative += monthlyProfit[i];
                cumulativeProfit.push(cumulative);
                prevCumulative += prevYearProfit[i];
                prevCumulativeProfit.push(prevCumulative);
            }

            // KPIå€¤ã®è¨ˆç®—ã¨æ›´æ–°
            updateMonthlyChartKPIs(monthlySales, monthlyProfit, cumulativeProfit, prevYearSales, prevYearProfit);

            monthlyProfitChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'å‰å¹´å£²ä¸Šé«˜',
                            type: 'bar',
                            data: prevYearSales,
                            backgroundColor: 'rgba(149, 165, 166, 0.4)',
                            borderColor: 'rgba(127, 140, 141, 0.8)',
                            borderWidth: 1,
                            yAxisID: 'y',
                            order: 3
                        },
                        {
                            label: 'ä»ŠæœŸå£²ä¸Šé«˜',
                            type: 'bar',
                            data: monthlySales,
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 2,
                            yAxisID: 'y',
                            order: 2
                        },
                        {
                            label: 'å‰å¹´åˆ©ç›Š',
                            type: 'bar',
                            data: prevYearProfit,
                            backgroundColor: prevYearProfit.map(val => val >= 0 ? 'rgba(149, 165, 166, 0.4)' : 'rgba(169, 68, 66, 0.4)'),
                            borderColor: prevYearProfit.map(val => val >= 0 ? 'rgba(127, 140, 141, 0.8)' : 'rgba(169, 68, 66, 0.8)'),
                            borderWidth: 1,
                            yAxisID: 'y1',
                            order: 4
                        },
                        {
                            label: 'ä»ŠæœŸåˆ©ç›Š',
                            type: 'bar',
                            data: monthlyProfit,
                            backgroundColor: monthlyProfit.map(val => val >= 0 ? 'rgba(46, 204, 113, 0.8)' : 'rgba(231, 76, 60, 0.8)'),
                            borderColor: monthlyProfit.map(val => val >= 0 ? 'rgba(46, 204, 113, 1)' : 'rgba(231, 76, 60, 1)'),
                            borderWidth: 2,
                            yAxisID: 'y1',
                            order: 1
                        },
                        {
                            label: 'ä»ŠæœŸç´¯è¨ˆåˆ©ç›Š',
                            type: 'line',
                            data: cumulativeProfit,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            borderWidth: 4,
                            fill: false,
                            tension: 0.4,
                            yAxisID: 'y1',
                            pointBackgroundColor: '#e74c3c',
                            pointBorderColor: '#c0392b',
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            order: 0
                        },
                        {
                            label: 'å‰å¹´ç´¯è¨ˆåˆ©ç›Š',
                            type: 'line',
                            data: prevCumulativeProfit,
                            borderColor: 'rgba(127, 140, 141, 0.9)',
                            backgroundColor: 'rgba(149, 165, 166, 0.1)',
                            borderWidth: 3,
                            borderDash: [8, 4],
                            fill: false,
                            tension: 0.4,
                            yAxisID: 'y1',
                            pointBackgroundColor: 'rgba(127, 140, 141, 0.9)',
                            pointBorderColor: 'rgba(95, 106, 106, 1)',
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            order: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                font: { size: 11, weight: 'bold' },
                                padding: 12,
                                generateLabels: function(chart) {
                                    const original = Chart.defaults.plugins.legend.labels.generateLabels;
                                    const labels = original.call(this, chart);
                                    
                                    // é †åºã‚’èª¿æ•´ï¼šä»ŠæœŸ â†’ å‰å¹´ ã®é †ã§è¡¨ç¤º
                                    const reordered = [
                                        labels.find(l => l.text === 'ä»ŠæœŸå£²ä¸Šé«˜'),
                                        labels.find(l => l.text === 'å‰å¹´å£²ä¸Šé«˜'),
                                        labels.find(l => l.text === 'ä»ŠæœŸåˆ©ç›Š'),
                                        labels.find(l => l.text === 'å‰å¹´åˆ©ç›Š'),
                                        labels.find(l => l.text === 'ä»ŠæœŸç´¯è¨ˆåˆ©ç›Š'),
                                        labels.find(l => l.text === 'å‰å¹´ç´¯è¨ˆåˆ©ç›Š')
                                    ].filter(Boolean);
                                    
                                    return reordered;
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        if (context.dataset.label.includes('å£²ä¸Š')) {
                                            label += context.parsed.y.toLocaleString() + 'ä¸‡å††';
                                        } else {
                                            label += (context.parsed.y >= 0 ? '+' : '') + context.parsed.y.toLocaleString() + 'ä¸‡å††';
                                        }
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'æœˆåº¦',
                                font: { size: 13, weight: 'bold' }
                            },
                            ticks: {
                                font: { size: 11, weight: 'bold' }
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'å£²ä¸Šé«˜ï¼ˆä¸‡å††ï¼‰',
                                font: { size: 13, weight: 'bold' },
                                color: '#3498db'
                            },
                            ticks: {
                                color: '#3498db',
                                font: { size: 11, weight: 'bold' },
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            },
                            grid: {
                                color: 'rgba(52, 152, 219, 0.1)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'å–¶æ¥­åˆ©ç›Šï¼ˆä¸‡å††ï¼‰',
                                font: { size: 13, weight: 'bold' },
                                color: '#27ae60'
                            },
                            ticks: {
                                color: '#27ae60',
                                font: { size: 11, weight: 'bold' },
                                callback: function(value) {
                                    return (value >= 0 ? '+' : '') + value.toLocaleString();
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            }
                        }
                    }
                }
            });
        }

        // æœˆæ¬¡ãƒãƒ£ãƒ¼ãƒˆKPIå€¤æ›´æ–°é–¢æ•°ï¼ˆå‰å¹´æ¯”è¼ƒå¯¾å¿œç‰ˆï¼‰
        function updateMonthlyChartKPIs(salesData, profitData, cumulativeData, prevSalesData, prevProfitData) {
            try {
                // ä»ŠæœŸè¨ˆç®—
                const totalSales = salesData.reduce((sum, val) => sum + val, 0);
                const avgMonthlySales = Math.round(totalSales / 12);
                const totalProfit = profitData.reduce((sum, val) => sum + val, 0);
                const avgMonthlyProfit = Math.round(totalProfit / 12);
                const profitRate = ((totalProfit / totalSales) * 100).toFixed(2);
                const maxProfit = Math.max(...profitData);
                const minProfit = Math.min(...profitData);
                const finalCumulative = cumulativeData[cumulativeData.length - 1];

                // å‰å¹´è¨ˆç®—
                const prevTotalSales = prevSalesData.reduce((sum, val) => sum + val, 0);
                const prevTotalProfit = prevProfitData.reduce((sum, val) => sum + val, 0);

                // å‰å¹´æ¯”è¨ˆç®—
                const salesGrowth = ((totalSales - prevTotalSales) / prevTotalSales * 100).toFixed(1);
                const profitGrowth = prevTotalProfit !== 0 ? ((totalProfit - prevTotalProfit) / Math.abs(prevTotalProfit) * 100).toFixed(1) : 'âˆ';

                // KPIè¦ç´ ã‚’æ›´æ–°
                updateElement('total-annual-sales', totalSales.toLocaleString() + 'ä¸‡å††');
                updateElement('avg-monthly-sales', avgMonthlySales.toLocaleString() + 'ä¸‡å††');
                updateElement('total-annual-profit', (totalProfit >= 0 ? '+' : '') + totalProfit.toLocaleString() + 'ä¸‡å††');
                updateElement('avg-monthly-profit', (avgMonthlyProfit >= 0 ? '+' : '') + avgMonthlyProfit.toLocaleString() + 'ä¸‡å††');
                updateElement('profit-margin', profitRate + '%');
                updateElement('cumulative-progress', (finalCumulative >= 0 ? '+' : '') + finalCumulative.toLocaleString() + 'ä¸‡å††');
                updateElement('max-monthly-profit', '+' + maxProfit.toLocaleString() + 'ä¸‡å††');
                updateElement('min-monthly-profit', minProfit.toLocaleString() + 'ä¸‡å††');

                // è‰²åˆ†ã‘ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨
                applyKPIColors();

                console.log('Monthly chart KPIs updated with YoY comparison:', {
                    salesGrowth: salesGrowth + '%',
                    profitGrowth: profitGrowth + '%'
                });
            } catch (error) {
                console.error('KPI update error:', error);
            }
        }

        // KPIè‰²åˆ†ã‘é©ç”¨
        function applyKPIColors() {
            const profitElements = ['total-annual-profit', 'avg-monthly-profit', 'cumulative-progress', 'max-monthly-profit'];
            const negativeElements = ['min-monthly-profit'];
            
            profitElements.forEach(id => {
                const element = document.getElementById(id);
                if (element && element.textContent.includes('+')) {
                    element.className = 'chart-kpi-item-value positive';
                }
            });
            
            negativeElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.className = 'chart-kpi-item-value negative';
                }
            });
        }

        // è¦ç´ æ›´æ–°ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }

        // äº‹æ¥­éƒ¨åˆ¥æœˆæ¬¡ãƒãƒ£ãƒ¼ãƒˆä½œæˆï¼ˆ3è»¸å¯¾å¿œç‰ˆï¼‰
        function createDepartmentChart(canvasId, deptKey) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;

            const months = ['7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ', '1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'];
            const previousData = PREVIOUS_YEAR_DATA[deptKey];
            const color = DEPT_COLORS[deptKey];
            
            // ä»ŠæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
            const currentData = previousData.monthly.map(val => val * (0.95 + Math.random() * 0.1));
            
            // æœˆæ¬¡åˆ©ç›Šãƒ‡ãƒ¼ã‚¿ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
            const monthlyProfit = [];
            const cumulativeProfit = [];
            let cumulative = 0;
            
            // éƒ¨é–€åˆ¥ã®åˆ©ç›Šç‡ã‚’é©ç”¨
            const profitRates = {
                sr: -0.08,  // SRäº‹æ¥­éƒ¨ã¯èµ¤å­—
                w: 0.15,    // Wäº‹æ¥­éƒ¨ã¯15%
                rc: 0.08,   // RCäº‹æ¥­éƒ¨ã¯8%
                rcd: 0.006  // RCDäº‹æ¥­éƒ¨ã¯0.6%ï¼ˆå¤§è¦æ¨¡ã ãŒè–„åˆ©ï¼‰
            };
            
            for (let i = 0; i < 12; i++) {
                const profit = Math.round(currentData[i] * profitRates[deptKey] * (0.8 + Math.random() * 0.4));
                monthlyProfit.push(profit);
                cumulative += profit;
                cumulativeProfit.push(cumulative);
            }

            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'å‰å¹´å®Ÿç¸¾',
                            type: 'bar',
                            data: previousData.monthly,
                            backgroundColor: '#95a5a633',
                            borderColor: '#7f8c8d',
                            borderWidth: 1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'ä»ŠæœŸå®Ÿç¸¾',
                            type: 'bar',
                            data: currentData,
                            backgroundColor: color + '77',
                            borderColor: color,
                            borderWidth: 2,
                            yAxisID: 'y'
                        },
                        {
                            label: 'æœˆæ¬¡åˆ©ç›Š',
                            type: 'bar',
                            data: monthlyProfit,
                            backgroundColor: monthlyProfit.map(val => val >= 0 ? 'rgba(46, 204, 113, 0.7)' : 'rgba(231, 76, 60, 0.7)'),
                            borderColor: monthlyProfit.map(val => val >= 0 ? 'rgba(46, 204, 113, 1)' : 'rgba(231, 76, 60, 1)'),
                            borderWidth: 1,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'ç´¯è¨ˆåˆ©ç›Š',
                            type: 'line',
                            data: cumulativeProfit,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            yAxisID: 'y1',
                            pointBackgroundColor: '#e74c3c',
                            pointBorderColor: '#c0392b',
                            pointRadius: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                boxWidth: 12,
                                padding: 8,
                                font: { size: 9 },
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        if (label.includes('åˆ©ç›Š')) {
                                            label += (context.parsed.y >= 0 ? '+' : '') + context.parsed.y.toLocaleString() + 'ä¸‡å††';
                                        } else {
                                            label += context.parsed.y.toLocaleString() + 'ä¸‡å††';
                                        }
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { font: { size: 8 } }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'å£²ä¸Šï¼ˆä¸‡å††ï¼‰',
                                font: { size: 10 },
                                color: color
                            },
                            ticks: { 
                                font: { size: 8 },
                                color: color,
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'åˆ©ç›Šï¼ˆä¸‡å††ï¼‰',
                                font: { size: 10 },
                                color: '#27ae60'
                            },
                            ticks: { 
                                font: { size: 8 },
                                color: '#27ae60',
                                callback: function(value) {
                                    return (value >= 0 ? '+' : '') + value.toLocaleString();
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            }
                        }
                    }
                }
            });
        }

        // ãƒ†ã‚¹ãƒˆé–¢æ•°
        function testTargetFunction() {
            console.log('testTargetFunction called');
            alert(`ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ\né…åˆ†çŠ¶æ…‹: ${targetAllocationEnabled ? 'ON' : 'OFF'}\néƒ¨é–€ãƒ‡ãƒ¼ã‚¿: ${JSON.stringify(departmentCurrentData, null, 2)}`);
            
            if (targetAllocationEnabled) {
                updateTargetAllocation();
            }
        }

        // ãã®ä»–ã®é–¢æ•°ï¼ˆã‚¹ã‚¿ãƒ–ï¼‰
        function refreshDashboardData() { console.log('refreshDashboardData called'); alert('ãƒ‡ãƒ¼ã‚¿æ›´æ–°å®Œäº†'); }
        function exportDebugData() { console.log('exportDebugData called'); alert('ãƒ‡ãƒãƒƒã‚°æƒ…å ±å‡ºåŠ›'); }
        function toggleDebugMode() { console.log('toggleDebugMode called'); }
        function loadIntegrationData() { console.log('loadIntegrationData called'); alert('çµ±åˆPLé€£æºç¢ºèª'); }
        function enableAutoSync() { console.log('enableAutoSync called'); alert('è‡ªå‹•åŒæœŸé–‹å§‹'); }
        function applyExecutiveAdjustment() { console.log('applyExecutiveAdjustment called'); alert('å½¹å“¡å ±é…¬è¨­å®šé©ç”¨'); }

        // åˆæœŸåŒ–å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard initialization started');
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            const allocationBtn = document.getElementById('allocation-toggle-btn');
            if (allocationBtn) {
                allocationBtn.addEventListener('click', toggleTargetAllocation);
            }
            
            const targetInput = document.getElementById('total-target');
            if (targetInput) {
                targetInput.addEventListener('change', function() {
                    if (targetAllocationEnabled) {
                        updateTargetAllocation();
                    }
                });
            }
            
            // ãƒãƒ£ãƒ¼ãƒˆä½œæˆ
            setTimeout(() => {
                createMonthlyProfitChart();
                departmentCharts.sr = createDepartmentChart('sr-monthly-chart', 'sr');
                departmentCharts.w = createDepartmentChart('w-monthly-chart', 'w');
                departmentCharts.rc = createDepartmentChart('rc-monthly-chart', 'rc');
                departmentCharts.rcd = createDepartmentChart('rcd-monthly-chart', 'rcd');
                
                console.log('Charts created successfully');
            }, 100);
            
            console.log('Dashboard initialization completed');
        });
    </script>
</body>
</html>
